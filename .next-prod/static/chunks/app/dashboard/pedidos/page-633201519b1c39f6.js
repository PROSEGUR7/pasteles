(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[160],{67125:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>c});var a=s(95155),i=s(12115);let l=e=>new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0}).format(e),r=["pendiente","enviado","pagado","entregado","cancelado"];function c(){let[e,t]=(0,i.useState)([]),[s,c]=(0,i.useState)([]),[n,d]=(0,i.useState)({page:1,limit:20,total:0,totalPages:0}),[o,x]=(0,i.useState)(!0),[m,u]=(0,i.useState)(""),[p,h]=(0,i.useState)(""),[f,j]=(0,i.useState)(null),[g,N]=(0,i.useState)(!1),[b,y]=(0,i.useState)(null),[v,w]=(0,i.useState)(null),[k,_]=(0,i.useState)(null),C=(0,i.useRef)(new Map),T=(0,i.useRef)(!1),S=(0,i.useCallback)(()=>{let e=window.AudioContext||window.webkitAudioContext;if(!e)return;let t=new e,s=t.createGain();s.connect(t.destination),s.gain.setValueAtTime(1e-4,t.currentTime);let a=t.createOscillator();a.type="sine",a.frequency.setValueAtTime(880,t.currentTime),a.connect(s);let i=t.createOscillator();i.type="sine",i.frequency.setValueAtTime(660,t.currentTime+.15),i.connect(s),s.gain.exponentialRampToValueAtTime(.12,t.currentTime+.01),s.gain.exponentialRampToValueAtTime(1e-4,t.currentTime+.3),a.start(t.currentTime),a.stop(t.currentTime+.15),i.start(t.currentTime+.15),i.stop(t.currentTime+.3),setTimeout(()=>{t.close().catch(()=>{})},350)},[]),P=(0,i.useCallback)(async function(){var e,s;let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,i=arguments.length>1?arguments[1]:void 0,l=null!=(e=null==i?void 0:i.silent)&&e,r=null!=(s=null==i?void 0:i.detectarCancelados)&&s;l||x(!0);let c=new URLSearchParams;c.set("page",String(a)),m&&c.set("sede",m),p&&c.set("estado",p);try{let e=await fetch("/api/pedidos?".concat(c)),s=await e.json(),a=s.pedidos||[];if(r&&T.current){let e=a.find(e=>{let t=C.current.get(e.id_pedido);return t&&"cancelado"!==t&&"cancelado"===e.estado});e&&(_({id:e.id_pedido,ticket:e.numero_ticket||"#".concat(e.id_pedido),cliente:e.cliente_nombre||"Sin cliente"}),S())}C.current=new Map(a.map(e=>[e.id_pedido,e.estado])),T.current||(T.current=!0),t(a),d(s.pagination||{page:1,limit:20,total:0,totalPages:0})}catch(e){console.error(e)}finally{l||x(!1)}},[m,p,S]);(0,i.useEffect)(()=>{fetch("/api/sedes").then(e=>e.json()).then(c).catch(()=>{})},[]),(0,i.useEffect)(()=>{P(1)},[P]),(0,i.useEffect)(()=>{if(!k)return;let e=setTimeout(()=>_(null),5e3);return()=>clearTimeout(e)},[k]),(0,i.useEffect)(()=>{let e=setInterval(()=>{P(n.page,{silent:!0,detectarCancelados:!0})},1e4);return()=>clearInterval(e)},[P,n.page]),(0,i.useEffect)(()=>{let e=e=>{let t=e.target;(null==t?void 0:t.closest("[data-acciones-container='true']"))||w(null)};return document.addEventListener("click",e),()=>document.removeEventListener("click",e)},[]);let D=async e=>{try{let t=await fetch("/api/pedidos/".concat(e)),s={error:"Respuesta inv\xe1lida"};try{s=await t.json()}catch(e){j(null),N(!1);return}if(!t.ok||!("pedido"in s)){j(null),N(!1);return}j(s),N(!0)}catch(e){j(null),N(!1)}},E=async(e,t)=>{y(e);try{(await fetch("/api/pedidos/".concat(e,"/estado"),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({estado:t})})).ok&&(P(n.page),w(null),(null==f?void 0:f.pedido)&&f.pedido.id_pedido===e&&j({...f,pedido:{...f.pedido,estado:t}}))}catch(e){console.error(e)}finally{y(null)}};return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"animate-in",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-surface-50",children:"Pedidos"}),(0,a.jsx)("p",{className:"text-surface-400 text-sm mt-1",children:"Gesti\xf3n y seguimiento de todos los pedidos"})]}),(0,a.jsxs)("div",{className:"glass-card p-4 flex flex-wrap items-center gap-4 animate-in",style:{animationDelay:"100ms"},children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"text-surface-500",children:(0,a.jsx)("polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"})}),(0,a.jsx)("span",{className:"text-sm text-surface-400",children:"Filtros:"})]}),(0,a.jsxs)("select",{value:m,onChange:e=>u(e.target.value),className:"select-field",children:[(0,a.jsx)("option",{value:"",children:"Todas las sedes"}),s.map(e=>(0,a.jsx)("option",{value:e.id_sede,children:e.nombre},e.id_sede))]}),(0,a.jsxs)("select",{value:p,onChange:e=>h(e.target.value),className:"select-field",children:[(0,a.jsx)("option",{value:"",children:"Todos los estados"}),r.map(e=>(0,a.jsx)("option",{value:e,className:"capitalize",children:e},e))]}),(0,a.jsx)("button",{onClick:()=>{u(""),h("")},className:"text-xs text-surface-500 hover:text-primary-400 transition-colors ml-auto",children:"Limpiar filtros"})]}),(0,a.jsx)("div",{className:"flex items-center justify-between animate-in",style:{animationDelay:"150ms"},children:(0,a.jsxs)("p",{className:"text-sm text-surface-500",children:[n.total," pedidos encontrados"]})}),(0,a.jsxs)("div",{className:"glass-card overflow-hidden animate-in",style:{animationDelay:"200ms"},children:[o?(0,a.jsx)("div",{className:"p-6 space-y-3",children:[1,2,3,4,5].map(e=>(0,a.jsx)("div",{className:"loading-skeleton h-12 rounded-lg"},e))}):0===e.length?(0,a.jsxs)("div",{className:"text-center py-16 text-surface-500",children:[(0,a.jsxs)("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",className:"mx-auto mb-3 text-surface-600",children:[(0,a.jsx)("path",{d:"M9 5H7a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2h-2"}),(0,a.jsx)("rect",{x:"9",y:"3",width:"6",height:"4",rx:"1"})]}),(0,a.jsx)("p",{className:"text-sm",children:"No hay pedidos que mostrar"}),(0,a.jsx)("p",{className:"text-xs text-surface-600 mt-1",children:"Ajusta los filtros o espera nuevos pedidos"})]}):(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"border-b border-surface-800/50 bg-surface-900/30",children:[(0,a.jsx)("th",{className:"text-left text-xs font-medium text-surface-500 uppercase tracking-wider py-3 px-5",children:"Ticket"}),(0,a.jsx)("th",{className:"text-left text-xs font-medium text-surface-500 uppercase tracking-wider py-3 px-5",children:"Cliente"}),(0,a.jsx)("th",{className:"text-left text-xs font-medium text-surface-500 uppercase tracking-wider py-3 px-5",children:"Sede"}),(0,a.jsx)("th",{className:"text-left text-xs font-medium text-surface-500 uppercase tracking-wider py-3 px-5",children:"Estado"}),(0,a.jsx)("th",{className:"text-right text-xs font-medium text-surface-500 uppercase tracking-wider py-3 px-5",children:"Total"}),(0,a.jsx)("th",{className:"text-right text-xs font-medium text-surface-500 uppercase tracking-wider py-3 px-5",children:"Fecha"}),(0,a.jsx)("th",{className:"text-center text-xs font-medium text-surface-500 uppercase tracking-wider py-3 px-5",children:"Acciones"})]})}),(0,a.jsx)("tbody",{className:"divide-y divide-surface-800/20",children:e.map(e=>(0,a.jsxs)("tr",{className:"table-row",children:[(0,a.jsx)("td",{className:"py-3.5 px-5",children:(0,a.jsx)("span",{className:"text-sm font-semibold text-surface-200",children:e.numero_ticket||"#".concat(e.id_pedido)})}),(0,a.jsx)("td",{className:"py-3.5 px-5",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-surface-300",children:e.cliente_nombre||"Sin cliente"}),e.cliente_telefono&&(0,a.jsx)("p",{className:"text-xs text-surface-500",children:e.cliente_telefono})]})}),(0,a.jsx)("td",{className:"py-3.5 px-5 text-sm text-surface-400",children:e.sede_nombre||"—"}),(0,a.jsx)("td",{className:"py-3.5 px-5",children:(0,a.jsx)("span",{className:"badge badge-".concat(e.estado),children:e.estado})}),(0,a.jsx)("td",{className:"py-3.5 px-5 text-sm font-semibold text-surface-200 text-right",children:l(parseFloat(e.total))}),(0,a.jsx)("td",{className:"py-3.5 px-5 text-sm text-surface-500 text-right",children:new Date(e.fecha).toLocaleDateString("es-CO",{day:"2-digit",month:"short",hour:"2-digit",minute:"2-digit"})}),(0,a.jsx)("td",{className:"py-3.5 px-5 text-center",children:(0,a.jsxs)("div",{className:"relative inline-block","data-acciones-container":"true",children:[(0,a.jsx)("button",{onClick:()=>w(v===e.id_pedido?null:e.id_pedido),className:"inline-flex items-center justify-center w-8 h-8 rounded-lg text-surface-500 hover:text-primary-500 hover:bg-primary-500/10 transition-colors","aria-label":"Abrir acciones",children:(0,a.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:[(0,a.jsx)("circle",{cx:"12",cy:"5",r:"1.8"}),(0,a.jsx)("circle",{cx:"12",cy:"12",r:"1.8"}),(0,a.jsx)("circle",{cx:"12",cy:"19",r:"1.8"})]})}),v===e.id_pedido&&(0,a.jsxs)("div",{className:"absolute right-0 mt-1 w-44 glass-card-light p-1.5 z-20 border border-surface-800/40",children:[(0,a.jsx)("button",{onClick:()=>{D(e.id_pedido),w(null)},className:"w-full text-left px-3 py-2 rounded-md text-xs text-surface-300 hover:bg-primary-500/10 transition-colors",children:"Ver detalle"}),r.map(t=>(0,a.jsxs)("button",{onClick:()=>E(e.id_pedido,t),disabled:b===e.id_pedido||t===e.estado,className:"w-full text-left px-3 py-2 rounded-md text-xs text-surface-300 hover:bg-primary-500/10 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:["Marcar como ",t]},t))]})]})})]},e.id_pedido))})]})}),n.totalPages>1&&(0,a.jsxs)("div",{className:"flex items-center justify-between px-5 py-4 border-t border-surface-800/30",children:[(0,a.jsxs)("p",{className:"text-xs text-surface-500",children:["P\xe1gina ",n.page," de ",n.totalPages]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{onClick:()=>P(n.page-1),disabled:n.page<=1,className:"px-3 py-1.5 rounded-lg text-xs font-medium bg-surface-800/50 text-surface-300 hover:bg-surface-700/50 disabled:opacity-30 disabled:cursor-not-allowed transition-colors",children:"Anterior"}),(0,a.jsx)("button",{onClick:()=>P(n.page+1),disabled:n.page>=n.totalPages,className:"px-3 py-1.5 rounded-lg text-xs font-medium bg-surface-800/50 text-surface-300 hover:bg-surface-700/50 disabled:opacity-30 disabled:cursor-not-allowed transition-colors",children:"Siguiente"})]})]})]}),g&&(null==f?void 0:f.pedido)&&(0,a.jsxs)("div",{className:"fixed inset-0 z-50 flex justify-end",children:[(0,a.jsx)("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm",onClick:()=>N(!1)}),(0,a.jsxs)("div",{className:"relative w-full max-w-lg bg-surface-900 border-l border-surface-800/50 overflow-y-auto animate-in",style:{animation:"slideIn 0.3s ease"},children:[(0,a.jsx)("style",{children:"@keyframes slideIn { from { transform: translateX(100%); } to { transform: translateX(0); } }"}),(0,a.jsxs)("div",{className:"sticky top-0 z-10 flex items-center justify-between p-6 border-b border-surface-800/50 bg-surface-900/95 backdrop-blur-sm",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-lg font-bold text-surface-100",children:"Detalle del Pedido"}),(0,a.jsx)("p",{className:"text-sm text-surface-500",children:f.pedido.numero_ticket||"#".concat(f.pedido.id_pedido)})]}),(0,a.jsx)("button",{onClick:()=>N(!1),className:"p-2 rounded-lg hover:bg-surface-800 text-surface-400 transition-colors",children:(0,a.jsxs)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,a.jsx)("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),(0,a.jsx)("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),(0,a.jsxs)("div",{className:"p-6 space-y-6",children:[(0,a.jsx)("div",{className:"flex items-center",children:(0,a.jsx)("span",{className:"badge badge-".concat(f.pedido.estado," text-sm"),children:f.pedido.estado})}),(0,a.jsxs)("div",{className:"glass-card-light p-4 space-y-2",children:[(0,a.jsx)("h4",{className:"text-xs font-medium text-surface-500 uppercase tracking-wider",children:"Cliente"}),(0,a.jsx)("p",{className:"text-sm font-medium text-surface-200",children:f.pedido.cliente_nombre||"Sin nombre"}),f.pedido.cliente_telefono&&(0,a.jsxs)("p",{className:"text-xs text-surface-400",children:["\uD83D\uDCDE ",f.pedido.cliente_telefono]}),f.pedido.cliente_email&&(0,a.jsxs)("p",{className:"text-xs text-surface-400",children:["✉️ ",f.pedido.cliente_email]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-xs font-medium text-surface-500 uppercase tracking-wider mb-3",children:"Productos"}),f.detalles.length>0?(0,a.jsx)("div",{className:"space-y-2",children:f.detalles.map(e=>(0,a.jsxs)("div",{className:"glass-card-light p-3 flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-surface-200",children:e.producto_nombre}),(0,a.jsxs)("p",{className:"text-xs text-surface-500",children:[e.cantidad," \xd7 ",l(parseFloat(e.precio_unitario))]})]}),(0,a.jsx)("span",{className:"text-sm font-bold text-primary-400",children:l(parseFloat(e.subtotal))})]},e.id_detalle))}):(0,a.jsx)("p",{className:"text-sm text-surface-500",children:"Sin detalles de productos"})]}),(0,a.jsxs)("div",{className:"glass-card p-4 flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-sm font-medium text-surface-300",children:"Total"}),(0,a.jsx)("span",{className:"text-xl font-bold text-primary-400",children:l(parseFloat(f.pedido.total))})]}),f.pagos.length>0&&(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-xs font-medium text-surface-500 uppercase tracking-wider mb-3",children:"Pagos"}),(0,a.jsx)("div",{className:"space-y-2",children:f.pagos.map(e=>(0,a.jsxs)("div",{className:"glass-card-light p-3 flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-surface-200",children:e.metodo_nombre}),(0,a.jsx)("p",{className:"text-xs text-surface-500",children:new Date(e.fecha).toLocaleDateString("es-CO")})]}),(0,a.jsx)("span",{className:"text-sm font-semibold text-emerald-400",children:l(parseFloat(e.monto))})]},e.id_pago))})]}),(0,a.jsxs)("div",{className:"glass-card-light p-4 space-y-2 text-xs text-surface-500",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:"Sede:"}),(0,a.jsx)("span",{className:"text-surface-300",children:f.pedido.sede_nombre})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:"Empleado:"}),(0,a.jsx)("span",{className:"text-surface-300",children:f.pedido.empleado_nombre||"—"})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:"Fecha:"}),(0,a.jsx)("span",{className:"text-surface-300",children:new Date(f.pedido.fecha).toLocaleString("es-CO")})]})]})]})]})]}),k&&(0,a.jsx)("div",{className:"fixed top-6 right-6 z-[60] max-w-sm w-full",children:(0,a.jsx)("div",{className:"glass-card border border-red-500/40 p-4 shadow-xl animate-in",children:(0,a.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs font-semibold uppercase tracking-wider text-red-400",children:"Pedido cancelado"}),(0,a.jsx)("p",{className:"text-sm font-semibold text-surface-100 mt-1",children:k.ticket}),(0,a.jsxs)("p",{className:"text-xs text-surface-400 mt-1",children:["Cliente: ",k.cliente]})]}),(0,a.jsx)("button",{onClick:()=>_(null),className:"text-surface-400 hover:text-surface-200 transition-colors","aria-label":"Cerrar alerta",children:(0,a.jsxs)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,a.jsx)("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),(0,a.jsx)("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]})})})]})}},72032:(e,t,s)=>{Promise.resolve().then(s.bind(s,67125))}},e=>{e.O(0,[441,255,358],()=>e(e.s=72032)),_N_E=e.O()}]);